// Full updated code has been provided in the previous message